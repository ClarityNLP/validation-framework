@(title: String)(subtitle: String)

@main(title) {
  <div ng-controller="searchController" class="ng-cloak">
	  <div class="container" ng-show="activeView === 'list'">
	  	<div class="row">

	  		<div class="col-xs-12 col-md-10">
	  			<h5>
	  			Search:
	  			</h5>
	  			<div>
	  				<input class="form-control" type="text" placeholder="Query..." ng-model="searchInput" ng-keypress="($event.which === 13)?doSearch(false):0" autofocus/>
	  			</div>
	  			<div style="padding-top:10px; float:right">
	  				<a id="btn-search" class="btn btn-success" ng-click="doSearch(false)" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Searching">Search Documents</a>
	  			</div>

	  		</div>
	  		<div class="col-xs-12 col-md-2">
	  			<h5>
	  			Filters:
	  		</div>
	  		<div class="col-xs-12 col-md-10" ng-show="!searched || currentDocuments.length === 0" style="padding-top:20px">
				<div class="jumbotron">
					<h3>What you can search:</h3>
					<ul>
						<li><b>Terms:</b> <pre>seizure</pre> <pre>headache</pre></li>
						<li><b>Phrases:</b> <pre>"high cholesterol"</pre><pre>"left lower back pain"</pre></li>
						<li><b>Wildcards:</b> <pre>epilep*</pre> <pre>in*able</pre>
						<li><b>Fuzzy Searches</b> (finds similarly spelled words): <pre>lobe~</pre>
							To find common misspellings, try:
							<pre>emphysema~0.7</pre>
						</li>
						<li><b>Proximity Searches</b> (find words that are a distance away from each other):
							<pre>"uncontrolled seizure"~5</pre>
						</li>
						<li><b>Boolean Operators:</b>
							<pre>tumor OR polyp</pre>
							<pre>"breast cancer" AND screening</pre>
							<pre>diabetes AND (hypertension OR "high blood pressure" OR hbp)</pre>
						</li>
					</ul>
				</div>
	  		</div>
	  		<div class="col-xs-12 col-md-10" ng-show="searched && currentDocuments.length > 0">
		  			  <ul id="resultTabs" class="nav nav-tabs" role="tablist" >
					    <li role="presentation" class="active"><a href="#reports" aria-controls="reports" role="tab" data-toggle="tab">Reports (<b>{{documentsSize}}</b>)</a></li>
					    <li role="presentation"><a href="#subjects" aria-controls="subjects" role="tab" data-toggle="tab">Patients (<b>{{subjects.length}}</b>)</a></li>
					  </ul>
			  			 <div class="tab-content">
						    <div role="tabpanel" class="tab-pane active" id="reports">
						  		<table class="table table-striped table-hover ">
					                <thead>
					                  <tr>
					                    <th>Document</th>
					                    <th>Patient</th>
					                    <th style="min-width: 90px;">Date</th>
					                    <th>Snippet</th>
					                  </tr>
					                </thead>
					                <tbody>
					                  <tr ng-repeat="doc in currentDocuments">
					                   	<td style="vertical-align:top"><span class="h5"><a ng-click="showDoc(doc)" style="cursor:pointer">{{doc.reportId}}</a></span></td>
					                   	<td style="vertical-align:top"><span class="h5"><a ng-click="showSubject(doc.subject, false)" style="cursor:pointer">{{doc.subject}}</a></span></td>
					                   	<td style="vertical-align:top"><span>{{doc.date}}</span></td>

					                   	<td style="vertical-align:top"><span class="h5" ng-bind-html="doc.snippet"></td>
					                  </tr>
					                </tbody>
				              </table>
				              <ul uib-pagination 
				              	total-items="documentsSize" 
				              	ng-model="currentPage" 
				              	max-size="maxSize" 
				              	class="pagination-md" 
				              	boundary-links="true" 
				              	items-per-page="rows"
				              	ng-change="pageChanged()"
				              	rotate="false"></ul>
				            </div>
		            <div role="tabpanel" class="tab-pane" id="subjects">
		            	<table class="table table-striped table-hover ">
			                <thead>
			                  <tr>
			                    <th>Patient</th>
			                    <th>Matching Document Count</th>
			                  </tr>
			                </thead>
			                <tbody>
			                  <tr ng-repeat="s in subjects | orderBy:'-count'">
			                   	<td style="vertical-align:top"><span class="h5"><a ng-click="showSubject(s.id, false)" style="cursor:pointer">{{s.id}}</a></span></td>
			                   	<td style="vertical-align:top"><span class="h5">{{s.count}}</td>
			                  </tr>
			                </tbody>
		              </table>
		            </div>
	  		</div>
	  	</div>
	  </div>
  </div>
  <div class="container" ng-show="activeView === 'document_detail'">
  	<div class="row">
  		<div class="col-xs-4">
  			<button class="btn btn-primary" ng-click="backView('list')">&laquo; Back to List</button>
  		</div>
  		<div class="col-xs-8">
  			<button class="btn btn-sm btn-default" style="float:right" ng-click="navigateDocs('forward')" ng-disabled="activeDocument.index === (rows - 1) || activeDocument.index === (currentDocuments.length - 1)">Next &raquo;</button>
  			<button class="btn btn-sm btn-default" style="float:right" ng-click="navigateDocs('back')" ng-disabled="activeDocument.index === 0">&laquo; Previous</button>
  		</div>
  	</div>
  	  <div class="row">
	  	<div class="col-xs-12">
	  		<div align="center">
	  			<h3>Report #{{activeDocument.reportId}}</h3>
	  		</div>
	  		<div class="row">
				<div class="col-xs-9">
					<h5><a style="cursor:pointer" ng-click="showSubject(activeDocument.subject, false)">Patient #{{activeDocument.subject}}</a></h5>
				</div>
				<div class="col-xs-3">
					<h5 style="float:right">{{activeDocument.date}}</h5>
				</div>
			</div>
			<document-view doc="activeDocument" viewtype="document"></document-view>
	  	</div>
	  </div>
  </div>

  <div class="container" ng-show="activeView === 'subject_detail'">
  	<div class="row">
  		<div class="col-xs-4">
  			<button class="btn btn-primary" ng-click="backView('list')">&laquo; Back to List</button>
  		</div>
  		<div class="col-xs-8">
  			<button class="btn btn-sm btn-default" style="float:right" ng-click="navigateSubjects('forward')">Next &raquo;</button>
  			<button class="btn btn-sm btn-default" style="float:right" ng-click="navigateSubjects('back')">&laquo; Previous</button>
  		</div>
  		<div class="col-xs-12">
  			<div style="float:right;font-size: large;">
  				<b>{{activeSubject.index + 1}}</b> of <b>{{subjects.length}}</b>
 			</div>
  		</div>
  	</div>
  	<div class="row">
  		<div class="col-xs-12">
  			<div align="center">
	  			<h2>Patient #{{activeSubject.id}}</h2>
	  			<h4 ng-show="activeSubject.gender && activeSubject.gender.length > 0">{{activeSubject.gender}}, <span title="Born: {{activeSubject.yearOfBirth}}">{{activeSubject.age}}</span></h4>
	  			<h5 ng-show="activeSubject.subjectCallsPending > 0" style="color:#006687"><i class="fa fa-circle-o-notch fa-spin"></i></h5>
	  		</div>
  		</div>
  		<div class="col-xs-2">
  			<h4>Filters: <small style="cursor:pointer">(<a ng-click="resetSubjectFilters(true)">Reset</a>)</small></h4>
  			<input ng-model="filterText" class="form-control">
  			<div class="checkbox" ng-repeat="f in validSubjectFilters">
  			  <br ng-if="f === 'documents'" />
              <label style="font-size:110%">
                <input type="checkbox" ng-model="activeValidSubjectFilters[f]"> {{ capitalize(f) }} <!--  (<span class="filter-count" attr-domain="{{f}}">0</span>)-->
              </label>
            </div>
            <div style="padding-top:2px">
            	<label>Search Documents: <input class="form-control" ng-model="searchDocumentsWithinSubject" ng-keypress="($event.which === 13)?doSearchWithinSubject():0"></label>
            	<a id="btn-search-within" class="btn btn-success" ng-click="doSearchWithinSubject()" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Searching">Search</a>
	  			
            </div>
  		</div>
  		<div class="col-xs-10">

	  		<div ng-repeat="d in activeSubject.dates | orderBy" attr-date="{{d}}" class="date-section">
	  			<div class="row" style="border-bottom: 1px solid #999999;margin: 0px;">
	  				<div class="col-xs-6" >
						<h4>{{ prettyDate(d) }}</h4>
					</div>
					<div class="col-xs-6">
						<h4 style="float: right;">{{ activeSubject.documents[d].length + activeSubject.records[d].length }} record(s)</h4>
					</div>
				</div>
				<div class="row" ng-show="activeSubject.records[d] && activeSubject.records[d].length > 0">
					<div class="col-xs-12">
						<table class="table table-striped table-hover ">
						      <colgroup>
						       <col span="1" style="width: 15%;">
						       <col span="1" style="width: 10%">
						       <col span="1" style="width: 55%;">
						       <col span="1" style="width: 20%;">
						    </colgroup>
			               <!-- <thead>
			                  <tr>
			                    <th>Domain</th>
			                    <th>Code</th>
			                    <th>Name</th>
			                    <th>Value</th>
			                  </tr>
			                </thead>
			                 --> 
			                <tbody>
			                  <tr attr-date="{{d}}" attr-domain="{{rec.domain}}" ng-show="activeValidSubjectFilters[rec.domain]" 
			                  	ng-repeat="rec in activeSubject.records[d] | orderBy: ['domain', 'conceptName']  | filter:filterText">
			                    <td>{{ capitalize(rec.domain) }}</td>
			                    <td>{{ rec.sourceConceptValue }}</td>
			                    <td><b>{{ rec.displayName }}</b></td>
			                    <td>{{ rec.displayValue }}</td>
			                  </tr>
			                </tbody>
			              </table>
					</div>
				</div>
				<div class="doc-row" attr-date="{{d}}" ng-show="activeValidSubjectFilters['documents']" ng-repeat="doc in activeSubject.documents[d]">
					<div class="row">
						<div class="col-xs-12">
							<h5>Report #{{doc.reportId}}</h5>
						</div>
					</div>
					<document-view doc="doc"></document-view>
				</div>
	  		</div>
	  	</div>
  	</div>
  </div>
}